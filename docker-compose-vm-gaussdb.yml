version: "3"

services:
  backend:
    image: blogcircle-backend:fixed
    container_name: blogcircle-backend
    network_mode: host
    volumes:
      - ./backend/src/main/resources/application.yml:/app/config/application.yml:ro
      - ./backend/src/main/resources/application-gaussdb-cluster.yml:/app/config/application-gaussdb-cluster.yml:ro
    entrypoint:
      [
        "java",
        "-Dspring.profiles.active=gaussdb-cluster",
        "-Dspring.config.additional-location=file:/app/config/",
        "-jar",
        "app.jar",
      ]
    environment:
      - SPRING_PROFILES_ACTIVE=gaussdb-cluster
      - SERVER_PORT=8081
      - JAVA_TOOL_OPTIONS=-Xms128m -Xmx256m -XX:+UseSerialGC
    restart: unless-stopped
    security_opt:
      - seccomp:unconfined
    ulimits:
      nproc: 65535
      nofile:
        soft: 65535
        hard: 65535

  frontend:
    build: ./frontend
    container_name: blogcircle-frontend
    ports:
      - "8080:80"
    depends_on:
      - backend
    restart: unless-stopped
