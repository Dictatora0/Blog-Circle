<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cloudcom.blog.mapper.AccessLogMapper">

    <insert id="insert" parameterType="AccessLog" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO access_logs (user_id, post_id, action, created_at)
        VALUES (#{userId}, #{postId}, #{action}, CURRENT_TIMESTAMP)
    </insert>

    <select id="selectAll" resultType="AccessLog">
        SELECT * FROM access_logs ORDER BY created_at DESC
    </select>

    <select id="countTodayViewByUserAndPost" resultType="int">
        SELECT COUNT(*) 
        FROM access_logs 
        WHERE user_id = #{userId} 
          AND post_id = #{postId} 
          AND action = 'VIEW_POST'
          AND DATE(created_at) = CURRENT_DATE
    </select>

</mapper>
