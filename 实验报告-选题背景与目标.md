# Blog Circle 系统实验报告

## 一、选题背景

### 1.1 研究背景

随着云计算和大数据技术的快速发展，现代 Web 应用系统面临着数据量激增、高并发访问、高可用性要求等多重挑战。传统的单机数据库架构已无法满足企业级应用的需求，分布式数据库集群和大数据分析技术成为解决这些问题的关键技术方向。

**当前技术趋势**：

- **数据库集群化**：通过主备复制、读写分离实现高可用和负载均衡
- **国产数据库崛起**：openGauss/GaussDB 等国产数据库在金融、政务等领域广泛应用
- **大数据分析**：Apache Spark 等分布式计算框架处理海量数据
- **微服务架构**：前后端分离、容器化部署成为主流

### 1.2 选题意义

本项目选择构建一个**朋友圈风格的博客系统**，结合 **GaussDB 一主二备集群** 和 **Spark 大数据分析**，具有以下实际意义：

**技术层面**：

1. **掌握国产数据库技术**：深入理解 openGauss/GaussDB 的主备复制、流复制、读写分离等核心机制
2. **实践分布式系统设计**：学习数据库集群部署、故障转移、负载均衡等关键技术
3. **应用大数据分析**：使用 Spark 进行用户行为分析、内容推荐等实际场景
4. **全栈开发能力**：涵盖前端（Vue 3）、后端（Spring Boot）、数据库、大数据的完整技术栈

**应用层面**：

1. **社交网络场景**：朋友圈式时间线、好友关系、互动功能贴近真实应用
2. **高并发处理**：读写分离架构支持大量用户同时访问
3. **数据分析需求**：用户行为统计、内容热度分析等实际业务需求
4. **可扩展性**：集群架构便于横向扩展，支持业务增长

### 1.3 技术选型

| 技术组件     | 选型                                  | 理由                                                  |
| ------------ | ------------------------------------- | ----------------------------------------------------- |
| **数据库**   | openGauss 9.2.4（虚拟机一主二备集群） | 国产数据库，兼容 PostgreSQL，支持主备流复制和读写分离 |
| **后端框架** | Spring Boot 3.1.5                     | 成熟的企业级框架，生态完善                            |
| **前端框架** | Vue 3 + Vite 4.5                      | 现代化前端技术栈，开发效率高                          |
| **大数据**   | Apache Spark 3.5.0                    | 分布式计算框架，支持大规模数据分析                    |
| **容器化**   | Docker + Docker Compose               | 简化部署，环境一致性                                  |
| **ORM**      | MyBatis 3.0.3                         | 灵活的 SQL 映射，适合复杂查询                         |

**数据库部署说明**：

- **虚拟机环境**：openGauss 9.2.4（一主二备集群，端口 5432/5434/5436）
- **操作系统**：openEuler 22.03 LTS
- **部署架构**：单机多实例，主备流复制（Streaming Replication）
- **高可用特性**：读写分离、自动故障检测、数据同步复制

---

## 二、实验目标

### 2.1 总体目标

构建一个完整的**朋友圈风格博客系统**，实现 **GaussDB 一主二备集群** 的部署与管理，集成 **Spark 大数据分析**，验证分布式数据库的高可用性、读写分离和数据分析能力。

### 2.2 具体目标

#### 目标 1：GaussDB 集群部署与配置

**核心任务**：

- 在单台虚拟机（10.211.55.11）上部署 GaussDB 一主二备集群
- 配置主库（端口 5432）、备库 1（端口 5434）、备库 2（端口 5436）
- 实现主备流复制（Streaming Replication）
- 解决端口冲突问题（GaussDB HA 端口机制）

**验证指标**：

- 三个实例全部正常运行
- 主库可读写，备库只读（恢复模式）
- 主库数据自动同步到备库
- 复制延迟 < 1 秒

#### 目标 2：读写分离架构实现

**核心任务**：

- 后端实现动态数据源路由（Primary/Replica）
- 使用 AOP 切面自动识别读写操作
- 配置 HikariCP 连接池优化性能
- 实现备库负载均衡

**验证指标**：

- 写操作（INSERT/UPDATE/DELETE）路由到主库
- 读操作（SELECT）路由到备库
- 连接池正常工作，无连接泄漏
- 后端日志显示正确的数据源切换

#### 目标 3：Spark 大数据分析集成

**核心任务**：

- 部署 Spark 集群（Master + Worker）
- 实现 Spark SQL 读取 GaussDB 数据
- 开发用户行为分析任务（发文统计、浏览统计、评论统计）
- 将分析结果写回数据库

**验证指标**：

- Spark 集群正常运行（Web UI 可访问）
- 成功读取 GaussDB 数据并进行聚合计算
- 统计结果准确且可查询
- 支持 SQL 分析作为备用方案

#### 目标 4：完整应用系统开发

**核心任务**：

- 实现用户注册/登录（JWT 认证）
- 实现文章发布、评论、点赞功能
- 实现好友关系管理（添加、删除、搜索）
- 实现朋友圈时间线（仅显示好友动态）
- 实现数据统计与可视化

**验证指标**：

- 前后端完整功能可用
- API 接口测试通过
- 用户体验流畅
- 数据一致性保证

#### 目标 5：集群管理与故障排查

**核心任务**：

- 开发集群管理脚本（启动、停止、验证）
- 开发故障诊断脚本（端口检查、日志分析）
- 开发自动修复脚本（端口重构、复制修复）
- 编写完整的运维文档

**验证指标**：

- 提供 12+ 个管理脚本
- 脚本可自动诊断并修复常见问题
- 文档完整，可快速部署
- 支持一键验证集群状态

### 2.3 学习目标

通过本实验，掌握以下核心能力：

**数据库技术**：

- GaussDB/openGauss 安装配置
- 主备复制原理与实践
- 流复制（Streaming Replication）配置
- 读写分离架构设计
- 数据库性能优化

**分布式系统**：

- 集群部署与管理
- 负载均衡策略
- 故障检测与恢复
- 数据一致性保证

**大数据技术**：

- Spark 集群部署
- Spark SQL 数据分析
- 分布式计算原理
- JDBC 数据源集成

**全栈开发**：

- Spring Boot 企业级开发
- Vue 3 现代前端开发
- RESTful API 设计
- JWT 身份认证
- Docker 容器化部署

---

## 三、实验内容

### 3.1 系统架构设计

#### 3.1.1 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                         用户层                               │
│                    Web Browser / Mobile                      │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                        前端层                                │
│          Vue 3 + Vite + Element Plus + Pinia                │
│              (端口 5173 / 8080)                              │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                        后端层                                │
│              Spring Boot 3 + MyBatis                        │
│         JWT 认证 + AOP 数据源路由 + HikariCP                │
│                    (端口 8080 / 8081)                        │
└─────────────────────────────────────────────────────────────┘
                              ↓
        ┌─────────────────────┴─────────────────────┐
        ↓                                           ↓
┌──────────────────┐                    ┌──────────────────┐
│  GaussDB 主库    │ ← 流复制 →         │  Spark 集群      │
│   (端口 5432)    │                    │  Master + Worker │
│   读写操作       │                    │   (端口 8090)    │
└──────────────────┘                    └──────────────────┘
        ↓                                           ↓
  ┌─────┴─────┐                              数据分析任务
  ↓           ↓
┌────────┐ ┌────────┐
│备库1   │ │备库2   │
│(5434)  │ │(5436)  │
│只读    │ │只读    │
└────────┘ └────────┘
```

#### 3.1.2 数据流向

**写操作流程**：

```
用户请求 → 前端 → 后端 API → AOP 拦截 → 主库 (5432) → 流复制 → 备库1/备库2
```

**读操作流程**：

```
用户请求 → 前端 → 后端 API → AOP 拦截 → 备库 (5434/5436 负载均衡)
```

**数据分析流程**：

```
触发分析 → Spark Master → Spark Worker → 读取备库数据 → 聚合计算 → 写入主库
```

### 3.2 GaussDB 集群部署

#### 3.2.1 环境准备

**虚拟机配置**：

- IP: 10.211.55.11
- 系统: openEuler 22.03 LTS
- 数据库版本: **openGauss 9.2.4**
- 内存: 4GB+
- 磁盘: 50GB+
- 管理用户: omm（数据库专用）
- 安装路径: /usr/local/opengauss

**端口规划**：
| 实例 | 主端口 | HA 端口 | 数据目录 |
|------|--------|--------|----------|
| 主库 | 5432 | 5433 | /usr/local/opengauss/data_primary |
| 备库 1 | 5434 | 5435 | /usr/local/opengauss/data_standby1 |
| 备库 2 | 5436 | 5437 | /usr/local/opengauss/data_standby2 |

**注意**：openGauss 每个实例需要 2 个连续端口（主端口+HA 端口），使用间隔端口（5432、5434、5436）避免冲突。本实验使用 openGauss 9.2.4 版本，该版本基于华为 GaussDB 内核，完全兼容 PostgreSQL 协议。
